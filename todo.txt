# Packrat Development Todo List

## Phase 1: File Explorer UI (Completed)
- [x] Set up project structure
- [x] Implement basic file explorer with navigation
- [x] Implement chroot functionality to prevent going above root
- [x] Add page up/page down navigation
- [x] Add home/end navigation
- [x] Fix any bugs in file explorer navigation
- [x] Add tests for Phase 1 functionality

## Phase 2: Text Viewer & Scrolling (Completed)
- [x] Implement basic text viewer that opens when a file is selected
- [x] Add vertical scrolling with keyboard controls
- [x] Add proper file content display
- [x] Handle large files efficiently
- [x] Exit back to file explorer
- [x] Add test for opening a text file and verifying content display
- [x] Add test for scrolling through file content
- [x] Add test for boundary conditions (no over-scrolling)
- [x] Add test for exiting and re-entering the viewer (state persistence)
- [x] Fix file opening with right arrow / L key
- [x] Add test for opening file with different key bindings

## Phase 2.5: Cleanup & UI Improvements (Completed)
- [x] Replace file/folder icons with cleaner Unicode symbols
- [x] Implement help panel with ? key for detailed shortcuts
- [x] Ensure status line is compact and fits in small terminals
- [x] Clean up unused imports and warnings in cargo
- [x] Optimize UI layout by moving titles into content blocks
- [x] Center titles in block headers for improved aesthetics
- [x] Add debug mode with UI state capture (Ctrl+D) for viewing the rendered UI
- [x] Improve debug message display with overlay at bottom of screen

## Phase 2.6: UI Fixes & Enhancements (Completed)
- [x] Fix ESC key to exit both help panel and viewer modes consistently
- [x] Update explorer mode to handle ESC key (should exit application)
- [x] Fix text color in light mode for text viewer
- [x] Update status line and debug text colors for better visibility in light mode
- [x] Reorder status line to prioritize help option for better visibility in small windows

## Phase 3: Line-Based Text Selection & Highlighting (Completed)
- [x] Implement line-based cursor movement
- [x] Add selection mode toggle with Space key
- [x] Track selected lines when cursor moves in selection mode
- [x] Add visual highlighting for selected lines
- [x] Allow exiting selection mode with Space key
- [x] Ensure selection persists when exiting selection mode
- [x] Reset selection when appropriate (new file)
- [x] Add tests for line selection functionality

## Phase 3.5: Integrated Text Editing (Optional)
- [x] Implement 'E' key to enter edit mode for selected lines
- [x] Integrate tui-textarea crate for editing capability
- [x] Allow editing of selected text before chunking (not modifying original file)
- [x] Return to viewer mode after editing
- [ ] When saving chunk with 'S' after editing, save the edited content, not original
- [x] Add appropriate error handling for empty selections
- [ ] Add tests for text editing functionality
- [ ] Add test to verify original files are NEVER modified by the editor

## Phase 4: Chunk Saving & Tracking
- [ ] Implement saving selected lines as chunk with 'S' key
- [ ] Support saving edited content from editor mode instead of original content
- [ ] Create chunks directory if it doesn't exist (./chunks/ by default)
- [ ] Create filename scheme for chunks: path_from_root_converted_to_underscores_START-END.txt (e.g., /foo/bar.py â†’ foo_bar_py_3-10.txt)
- [ ] Track original selected region in source file even if chunk content is edited
- [ ] Add chunk metadata format tracking: original file path, start/end lines, edit status, etc.
- [ ] Implement tracking of which lines have been chunked for each file
- [ ] Highlight saved chunks in the viewer with different color than selections
- [ ] Implement chunk overlap detection and warn users
- [ ] Update file explorer to show chunking progress (color-code files)
- [ ] Update status indicators after chunking to show progress
- [ ] Add Viewer mode indicator when viewing files with chunks
- [ ] Create mechanism to list and browse all chunks for a file
- [ ] Add tests for chunk saving functionality
- [ ] Add test to verify chunk content matches edited version when using editor mode
- [ ] Add gitignore entry for chunks directory

## Data Safety Tests (Critical)
- [ ] Create comprehensive test suite to verify original files are never modified
- [ ] Test all paths: direct chunking, edit-then-chunk, undo/redo, filesystem events
- [ ] Add file integrity checks before and after operations
- [ ] Implement test with filesystem monitoring to detect any unauthorized writes
- [ ] Add stress tests with simulated crashes to ensure data safety
- [ ] Document data safety guarantees in README

## Phase 5: Filesystem Monitoring
- [ ] Implement file system watching with Notify crate
- [ ] Update UI when files change externally
- [ ] Track chunk files and update highlights accordingly
- [ ] Add tests for filesystem monitoring

## Phase 6: Undo Feature
- [ ] Implement undo for last chunk with 'R' key
- [ ] Maintain an undo stack for tracking chunks
- [ ] Optionally implement redo with Shift+R
- [ ] Update UI highlights when undoing/redoing
- [ ] Add tests for undo/redo functionality

## Phase 7: Polish & Further Stretch Goals
- [ ] Add configuration file support (TOML/YAML)
- [ ] Implement custom keybindings
- [ ] Add Alacritty theme support
- [ ] Improve error handling for permission issues
- [ ] Add performance optimizations for large files
- [ ] Consider enhancements to editor functionality
